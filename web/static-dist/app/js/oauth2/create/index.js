webpackJsonp(["app/js/oauth2/create/index"],{0:function(e,t){e.exports=jQuery},"04e12e97a64b943320e3":function(e,t,a){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var n=a("7ab4a89ebadbfdecc2bf"),r=s(n),i=a("4602c3f5fe7ad9e3e91d"),d=s(i),c=a("e104a65d9efb9ac573bc"),o=a("b334fd7e4c5a19234db2"),u=(s(o),a("0fcd3a355c9fe74234e3")),l=a("5eb223de522186da1dd9"),f=s(l),h=a("bbc0ef257199acca9fed"),g=s(h),m=function(){function e(){(0,r.default)(this,e),this.$form=$("#third-party-create-account-form"),this.$btn=$(".js-submit-btn"),this.validator=null,this.dragCaptchaToken="",this.smsToken=null,this.$sendBtn=$(".js-sms-send"),this.drag=!!$("#drag-btn").length&&new g.default($("#drag-btn"),$(".js-jigsaw"),{limitType:"bind_register"}),this.init()}return(0,d.default)(e,[{key:"init",value:function(){this.initValidator(),this.smsSend(),this.submitForm(),this.removeSmsErrorTip(),this.dragEvent()}},{key:"dragEvent",value:function(){var e=this;this.drag&&this.drag.on("success",function(t){e.$sendBtn.attr("disabled",!1),e.dragCaptchaToken=t.token}),$(".js-drag-jigsaw").hasClass("hidden")||this.addDragCaptchaRules()}},{key:"initValidator",value:function(){this.rules={username:{required:!0,byte_minlength:4,byte_maxlength:18,nickname:!0,chinese_alphanumeric:!0,es_remote:{type:"get"}},invitedCode:{required:!1,reg_inviteCode:!0,es_remote:{type:"get"}},password:{required:!0,minlength:5,maxlength:20},confirmPassword:{required:!0,equalTo:"#password"},sms_code:{required:!0,unsigned_integer:!0,rangelength:[6,6]}},this.validator=this.$form.validate({rules:this.rules,messages:{sms_code:{required:Translator.trans("site.captcha_code.required"),rangelength:Translator.trans("validate.sms_code.message")}}})}},{key:"smsSend",value:function(){var e=this,t=this,a=$("#captcha_code");this.$sendBtn.length&&this.$sendBtn.click(function(s){t.smsSended||($.ajaxSetup({global:!1}),t.smsSended=!0),t.$sendBtn.attr("disabled",!0);var n={type:"register",mobile:$(".js-account").text(),dragCaptchaToken:e.dragCaptchaToken,phrase:a.val()};f.default.sms.send({data:n}).then(function(t){$.ajaxSetup({global:!0}),e.smsToken=t.smsToken,(0,u.countDown)(120)}).catch(function(e){t.drag&&($.ajaxSetup({global:!0}),t.addDragCaptchaRules(),t.drag.initDragCaptcha(),$(".js-drag-jigsaw").removeClass("hidden"))})})}},{key:"submitForm",value:function(){var e=this;this.$btn.click(function(t){var a=$(t.target);if(e.validator.form()){a.button("loading");var s={nickname:$("#username").val(),password:$("#password").val(),mobile:$(".js-account").html(),smsToken:e.smsToken,smsCode:$("#sms-code").val(),captchaToken:e.captchaToken,phrase:$("#captcha_code").val(),dragCaptchaToken:$('[name="dragCaptchaToken"]').val(),invitedCode:$("#invitedCode").length>0?$("#invitedCode").val():""},n=Translator.trans("oauth.send.sms_code_error_tip");$.post(a.data("url"),s,function(e){a.button("reset"),1===e.success?window.location.href=e.url:$(".js-password-error").length||a.prev().addClass("has-error").append('<p id="password-error" class="form-error-message js-password-error">'+n+"</p>")}).error(function(e){a.button("reset")})}}),(0,c.enterSubmit)(this.$form,this.$btn)}},{key:"addDragCaptchaRules",value:function(){$('[name="dragCaptchaToken"]').rules("add",{required:!0,messages:{required:Translator.trans("auth.register.drag_captcha_tips")}})}},{key:"removeSmsErrorTip",value:function(){$("#sms-code").focus(function(){var e=$(".js-password-error");e.length&&e.remove()})}}]),e}();t.default=m},"0fcd3a355c9fe74234e3":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.countDown=void 0;var s=a("b334fd7e4c5a19234db2"),n=function(e){return e&&e.__esModule?e:{default:e}}(s),r=$(".js-time-left"),i=$(".js-sms-send"),d=$(".js-fetch-btn-text"),c=(t.countDown=function(e){r.html(e),d.html(Translator.trans("site.data.get_sms_code_again_btn")),(0,n.default)("success",Translator.trans("site.data.get_sms_code_success_hint")),c()},function e(){var t=r.text();r.html(t-1),t-1>0?(i.attr("disabled",!0),setTimeout(e,1e3)):(r.html(""),d.html(Translator.trans("oauth.send.validate_message")),i.removeAttr("disabled"))})},"1d43a4025aadc22df310":function(e,t,a){"use strict";var s=a("04e12e97a64b943320e3");new(function(e){return e&&e.__esModule?e:{default:e}}(s).default)},"2d54b0801acfe6b5b5d9":function(e,t,a){e.exports={default:a("7ef299c1fdb884750de8"),__esModule:!0}},"5a1b42cd4752706663d8":function(e,t,a){"use strict";var s=a("30373b8543ac2ca8f199"),n=a("4373c1ac6d15a5b2dd1f");e.exports=function(e,t,a){t in e?s.f(e,t,n(0,a)):e[t]=a}},"7a079e57c8ffba47bbed":function(e,t,a){"use strict";t.__esModule=!0;var s=a("2d54b0801acfe6b5b5d9"),n=function(e){return e&&e.__esModule?e:{default:e}}(s);t.default=function(e){if(Array.isArray(e)){for(var t=0,a=Array(e.length);t<e.length;t++)a[t]=e[t];return a}return(0,n.default)(e)}},"7ef299c1fdb884750de8":function(e,t,a){a("9f5e733705cd16698cdf"),a("dfa37eb698c113f70efb"),e.exports=a("99ec8b6ce9e8b820539a").Array.from},bbc0ef257199acca9fed:function(e,t,a){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var n=a("7a079e57c8ffba47bbed"),r=s(n),i=a("6415c664294d747ee392"),d=s(i),c=a("adc6e7d88332518aa1ec"),o=s(c),u=a("cd078759ac479d74803f"),l=s(u),f=a("7ab4a89ebadbfdecc2bf"),h=s(f),g=a("4602c3f5fe7ad9e3e91d"),m=s(g),v=a("1ff717687cc04d94af8f"),p=s(v),b=a("3b1883fc74dc0f9509af"),k=s(b),_=a("5eb223de522186da1dd9"),y=s(_),j=a("9181c6995ae8c5c94b7a"),C=a("17c25dd7d9d2615bc1d9"),w=s(C),T=function(e){function t(e,a,s){(0,h.default)(this,t);var n=(0,p.default)(this,(t.__proto__||(0,l.default)(t)).call(this));return n.$element=e,n.$target=a,n.params={top:0,left:0,currentX:0,currentY:0,flag:!1,currentLeft:0,currentTop:0},n.data=(0,o.default)({times:2},s),n.dragCaptchaToken=null,n.init(),n}return(0,k.default)(t,e),(0,m.default)(t,[{key:"init",value:function(){this.initDragCaptcha(),this.getLocation(this.$element[0])}},{key:"initDragCaptcha",value:function(){var e=this,t=this;y.default.dragCaptcha.get({before:function(){$(".js-drag-img-mask").removeClass("hidden"),$(".js-jigsaw-bg").remove(),$(".js-jigsaw").attr("src",""),t.setCss(t.$element[0],"cursor","pointer"),t.resetLocation(t.$element[0],t.$target[0]),$('[name="dragCaptchaToken"]').val(""),t.initEvent()},data:this.data}).then(function(t){e.loadingImg(t.url,t.jigsaw),e.dragCaptchaToken=t.token})}},{key:"loadingImg",value:function(e,t){var a=new Image;a.src=e,a.className="js-jigsaw-bg drag-img__bg",a.onload=function(){$(".js-jigsaw-bg").length>0||($(a).prependTo(".js-drag-img"),$(".js-drag-img-mask").addClass("hidden"),$(".js-jigsaw").attr("src",t))}}},{key:"initEvent",value:function(){var e=this;this.unbindEvent();var t=$(document);this.$element.on("mousedown.drag.captcha touchstart.drag.captcha",function(t){e.startDrag(t)}),t.on("mouseup.drag.captcha touchend.drag.captcha",function(t){e.stopDrag(t)}),t.on("mousemove.drag.captcha touchmove.drag.captcha",function(t){e.dragMove(t)})}},{key:"unbindEvent",value:function(){this.$element.unbind("mousedown.drag.captcha touchstart.drag.captcha"),$(document).unbind("mousemove.drag.captcha touchmove.drag.captcha mouseup.drag.captcha touchend.drag.captcha")}},{key:"startDrag",value:function(e){e.preventDefault();var t=this.params;t.flag=!0;var a=e.clientX?e.clientX.toFixed(2):e.originalEvent.targetTouches[0].pageX.toFixed(2);t.currentX=a}},{key:"stopDrag",value:function(e){var t=this,a=this.$element,s=(this.$target,this.params);if(s.flag&&(s.flag=!1,this.getLocation(a[0]),s.currentLeft)){var n=$(".js-jigsaw-bg"),r=this.calPositionX(n),i=this._getToken(this.dragCaptchaToken,r),d={token:i};y.default.dragCaptcha.validate({params:d}).then(function(e){t.validateSuccess(a[0],i)}).catch(function(){t.initDragCaptcha(),t.emit("error")})}}},{key:"dragMove",value:function(e){var t=this.$element,a=this.$target,s=this.params;if(s.flag){e.preventDefault();var n=e.clientX?e.clientX.toFixed(2):e.originalEvent.targetTouches[0].pageX.toFixed(2),r=n-s.currentX,i=t.parent().width()-t.width(),d=parseInt(s.left)+r;d<=0&&(d=0),d>=i&&(d=i),s.currentLeft=d;var c=d+"px";this.setCss(t[0],"left",c),this.setCss(a[0],"left",c),this.setCss(t[0],"cursor","move"),$(".js-drag-bar-tip").addClass("hidden");var o=d+20+"px";$(".js-drag-bar-mask").css("width",o)}}},{key:"calPositionX",value:function(e){var t=(e[0].naturalWidth/e.width()).toFixed(2);return(this.params.currentLeft.toFixed(2)*t).toFixed(2)}},{key:"validateSuccess",value:function(e,t){cd.message({type:"success",message:Translator.trans("validate.success")});var a=$('[name="dragCaptchaToken"]');a.val(t);var s=a.closest(".form-group");s.removeClass("has-error"),s.find(".jq-validate-error").remove(),this.unbindEvent(),this.setCss(e,"cursor","not-allowed"),this.emit("success",{token:t})}},{key:"getLocation",value:function(e){"auto"!==this.getCss(e,"left")&&(this.params.left=this.getCss(e,"left"))}},{key:"resetLocation",value:function(e,t){this.setCss(e,"left","0px"),this.setCss(t,"left","0px"),this.getLocation(e),$(".js-drag-bar-mask").css("width","0px"),$(".js-drag-bar-tip").removeClass("hidden")}},{key:"getCss",value:function(e,t){return e.currentStyle?e.currentStyle[t]:document.defaultView.getComputedStyle(e,!1)[t]}},{key:"setCss",value:function(e,t,a){e.style[t]=a}},{key:"_getToken",value:function(e,t){var a={token:e,captcha:t};return e=(0,d.default)(a),[].concat((0,r.default)((0,j.strToBase64)(e))).reverse().join("")}}]),t}(w.default);t.default=T},dfa37eb698c113f70efb:function(e,t,a){"use strict";var s=a("a0ce7130a92293994282"),n=a("d30516674aade65150d3"),r=a("68be1979658d3a49fbce"),i=a("be5ff68e5fc2b36ab3fd"),d=a("7bbcd029dba3160182ef"),c=a("10f5bc3e6ad5971b57b0"),o=a("5a1b42cd4752706663d8"),u=a("a5b03ec781f71e8d0bed");n(n.S+n.F*!a("9192d99c20a30ab204d7")(function(e){Array.from(e)}),"Array",{from:function(e){var t,a,n,l,f=r(e),h="function"==typeof this?this:Array,g=arguments.length,m=g>1?arguments[1]:void 0,v=void 0!==m,p=0,b=u(f);if(v&&(m=s(m,g>2?arguments[2]:void 0,2)),void 0==b||h==Array&&d(b))for(t=c(f.length),a=new h(t);t>p;p++)o(a,p,v?m(f[p],p):f[p]);else for(l=b.call(f),a=new h;!(n=l.next()).done;p++)o(a,p,v?i(l,m,[n.value,p],!0):n.value);return a.length=p,a}})},e104a65d9efb9ac573bc:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=function(e,t){e.keypress(function(e){13==e.which&&(t.trigger("click"),e.preventDefault())})};t.enterSubmit=s}},["1d43a4025aadc22df310"]);