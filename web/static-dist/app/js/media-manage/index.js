webpackJsonp(["app/js/media-manage/index"],{0:function(t,e){t.exports=jQuery},"0aaefd8f8edce9d8cb8f":function(t,e,n){"use strict";var i=n("4e9151fb4a048110077b");new(function(t){return t&&t.__esModule?t:{default:t}}(i).default)},"16dca8fd088a3c871f3f":function(t,e,n){"use strict";function i(t,e){return t*$("#editbox-lesson-list").width()/parseInt(e)+20}function s(t,e){return Math.round((t-20)*e/$("#editbox-lesson-list").width())}for(var a=n("609d911a24b2b709511a"),r=function(t){return t&&t.__esModule?t:{default:t}}(a),o=n("9181c6995ae8c5c94b7a"),l=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(o),c=$(".js-editbox"),d=$("#editbox-lesson-list"),u=c.data("mediaLength"),f=u/6,h=0;h<=6;h++){var p=$('[data-role="scale-default"]').clone().css("left",i(f*h,u)).removeClass("hidden").removeAttr("data-role");p.find('[data-role="scale-time"]').text(l.sec2Time(Math.round(f*h))),$('[data-role="scale-default"]').before(p)}r.default.on("timechange",function(t){$(".scale-white").css("left",i(t.currentTime,u))}),$(".scale-white").on("mousedown",function(t){var e=!1;$(document).on("mousemove.playertime",function(t){window.getSelection?window.getSelection().removeAllRanges():document.selection.empty();var e=t.pageX>d.width()+20?d.width()+20:t.pageX&&t.pageX<=20?20:t.pageX;$(".scale-white").css("left",e);var n=s(e,u);r.default.sendToChild({id:"viewerIframe"},"setCurrentTime",{time:n})}).on("mouseup.playertime",function(t){$(document).off("mousemove.playertime"),$(document).off("mousedown.playertime"),e=!0})})},"27d19b4547a9c8dcdebe":function(t,e,n){var i=n("7ea730999b7f9bc57768"),s=n("6d5fc844ee5e8f1afd1c");t.exports=function(t,e){if(!e.start||!e.end||!e.text)throw new Error("Invalid caption data");for(var n in e)if(e.hasOwnProperty(n)&&"text"!==n&&("start"===n||"end"===n)){if(/^(\d{2}):(\d{2}):(\d{2}),(\d{3})$/.test(e[n]))continue;if(!/^\d+$/.test(e[n]))throw new Error("Invalid caption time format");e[n]=s(e[n])}return t.push({index:t.length+1,start:e.start,end:e.end,duration:i(e.end)-i(e.start),text:e.text}),t}},"4e9151fb4a048110077b":function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var s=n("14f78623669da6cd31fb"),a=i(s),r=n("7ab4a89ebadbfdecc2bf"),o=i(r),l=n("4602c3f5fe7ad9e3e91d"),c=i(l);n("b26ed6014df6ee9a0332"),n("16dca8fd088a3c871f3f");var d=n("90c40b9c35e074e923b0"),u=i(d),f=n("609d911a24b2b709511a"),h=i(f),p=n("b334fd7e4c5a19234db2"),m=i(p),v=n("d5971171c2b26114cfc1"),b=i(v),g=$(".text-track-overview"),w=$("#uploader"),x=function(){function t(){(0,o.default)(this,t),this.select=null,this.init()}return(0,c.default)(t,[{key:"init",value:function(){this.initTextDisplay(),this.initSelect(),this.initUploader()}},{key:"initTextDisplay",value:function(){var t=$(".manage-edit-body").height(),e=$(".nav-tabs-edit").height(),n=$(".text-track-title").height(),i=$("#track-select").height();g.height(t-e-n-i-140).show()}},{key:"initSelect",value:function(){var t=(0,a.default)(u.default),e=$("#track-select"),n=e.data("subtitleList"),i=w.data("mediaId"),s=this;t.init({id:"#track-select",optionsLimit:4}),t.on("valuechange",function(t){if(!t)return void g.html(Translator.trans("subtitle.no_subtitle_hint"));$.ajax({url:t.url,type:"GET"}).done(s.showSubtitleContent)}),t.on("deleteoption",function(t){var e="/media/"+i+"/subtitle/"+t.id+"/delete";$.post(e,function(t){t&&((0,m.default)("success",Translator.trans("subtitle.delete_success_hint")),w.show())})}),t.on("optionlimit",function(){w.hide()}),t.resetOptions(n),this.select=t}},{key:"initUploader",value:function(){var t=this.select,e=w.data("mediaGlobalId"),n=w.data("mediaId"),i=w.data("subtitleCreateUrl"),s=new UploaderSDK({initUrl:w.data("initUrl"),finishUrl:w.data("finishUrl"),id:"uploader",ui:"simple",multi:!0,accept:{extensions:["srt"],mimeTypes:["text/srt"]},type:"sub",process:{common:{videoNo:e}}});s.on("error",function(t){"Q_TYPE_DENIED"===t.error&&(0,m.default)("danger",Translator.trans("subtitle.upload_srt_hint"))}),s.on("file.finish",function(e){$.post(i,{name:e.name,subtitleId:e.id,mediaId:n}).success(function(e){e&&(t.addOption(e),(0,m.default)("success",Translator.trans("subtitle.upload_success_hint")),setTimeout(function(){var e="/media/"+n+"/subtitles";$.get(e).done(function(e){e.subtitles&&t.resetOptions(e.subtitles)})},5e3))}).error(function(t){(0,m.default)("danger",Translator.trans(t.responseJSON.error.message))})})}},{key:"showSubtitleContent",value:function(t){var e=new b.default;try{e.parse(t)}catch(t){return(0,m.default)("danger",Translator.trans("subtitle.parse_error_hint")),void g.html(Translator.trans("subtitle.parse_error_hint"))}var n=e.getSubtitles({duration:!0,timeFormat:"ms"}),i="";n.map(function(t){i+="<p>"+t.text+"</p>"}),g.html(i);var s=g.find("p");h.default.on("timechange",function(t){setTimeout(function(){var e=n.find(function(e,n){if(e.start/1e3>t.currentTime)return e});s.removeClass("active"),e&&e.index>1&&n[e.index-2].end>1e3*parseFloat(t.currentTime)&&s.eq(e.index-2).addClass("active")},0)})}}]),t}();e.default=x},"4fbc8f4e49952771dc85":function(t,e){t.exports=function(t){var e="";return t.forEach(function(t,n){n>0&&(e+="\n"),e+=t.index,e+="\n",e+=t.start+" --\x3e "+t.end,e+="\n",e+=t.text,e+="\n"}),e}},"558e05aa09312b06bb5c":function(t,e,n){var i=n("631b083c4a39c1f7f104"),s=n("7ea730999b7f9bc57768"),a={timeFormat:"srt",duration:!1};t.exports=function(t,e){return e=i(a,e),"ms"===e.timeFormat&&(t=t.map(function(t){return t.start=s(t.start),t.end=s(t.end),t})),e.duration||(t=t.map(function(t){return delete t.duration,t})),t}},"609d911a24b2b709511a":function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n("06597b47670159844043"),s=function(t){return t&&t.__esModule?t:{default:t}}(i),a=new s.default({name:"parent",project:"PlayerProject",children:[document.getElementById("viewerIframe")],type:"parent"});e.default=a},"62dd28380e65e28b6966":function(t,e,n){var i=n("7ea730999b7f9bc57768");t.exports=function(t){var e,n,s,a,r,o=[];if(!t)throw new Error("No SRT to parse");return t=t.trim(),t+="\n",t=t.replace(/\r\n/g,"\n").replace(/\n{3,}/g,"\n\n").split("\n"),t.forEach(function(t){if(t=t.toString(),!e&&/^\d+$/.test(t))return void(e=parseInt(t));if(!n){var l=t.match(/^(\d{2}:\d{2}:\d{2},\d{3}) --> (\d{2}:\d{2}:\d{2},\d{3})$/);if(l)return a=l[1],r=l[2],void(n=!0)}""===t.trim()?(o.push({index:e,start:a,end:r,duration:i(r)-i(a),text:s||""}),e=n=a=r=s=null):s?s+="\n"+t:s=t}),o}},"631b083c4a39c1f7f104":function(t,e){function n(){for(var t={},e=0;e<arguments.length;e++){var n=arguments[e];for(var s in n)i.call(n,s)&&(t[s]=n[s])}return t}t.exports=n;var i=Object.prototype.hasOwnProperty},"6d5fc844ee5e8f1afd1c":function(t,e){t.exports=function(t){if(!/^\d+$/.test(t.toString()))throw new Error("Time should be an Integer value in milliseconds");t=parseInt(t);var e=new Date(0,0,0,0,0,0,t),n=e.getHours()<10?"0"+e.getHours():e.getHours(),i=e.getMinutes()<10?"0"+e.getMinutes():e.getMinutes(),s=e.getSeconds()<10?"0"+e.getSeconds():e.getSeconds(),a=t-(36e5*n+6e4*i+1e3*s);return a<100&&a>=10?a="0"+a:a<10&&(a="00"+a),n+":"+i+":"+s+","+a}},"7ea730999b7f9bc57768":function(t,e){t.exports=function(t){var e=t.match(/^(\d{2}):(\d{2}):(\d{2}),(\d{3})$/);if(!e)throw new Error("Invalid SRT time format");var n=parseInt(e[1],10),i=parseInt(e[2],10),s=parseInt(e[3],10),a=parseInt(e[4],10);return n*=36e5,i*=6e4,s*=1e3,n+i+s+a}},"90c40b9c35e074e923b0":function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(t){return{waiting:Translator.trans("subtitle.status.waiting"),doing:Translator.trans("subtitle.status.doing"),success:Translator.trans("subtitle.status.success"),error:Translator.trans("subtitle.status.error"),none:Translator.trans("subtitle.status.waiting")}[t]},s={init:function(t){this.$el=$(t.id),this.options=[],this.optionsLimit=t.optionsLimit||!1,this.eventManager={},this.initParent(),this.initEvent()},initParent:function(){var t=$(document.createDocumentFragment());t.append(this.templete()),this.$el.append(t),this.$parentDom=$(".track-select-parent"),this.$list=$(".track-selcet-list"),this.$dataShow=this.$parentDom.find(".data-show"),this.$open=this.$parentDom.find(".track-selcet-open-arrow"),this.$close=this.$parentDom.find(".track-selcet-close-arrow"),this.$showBox=this.$parentDom.find(".track-select-show")},initEvent:function(){var t=this;this.$parentDom.delegate(".track-selcet-open-arrow","click",this.handleOpen.bind(this)).delegate(".track-selcet-close-arrow","click",this.handleClose.bind(this)).delegate(".delete","click",this.handleDelete.bind(this)).delegate(".select-item","click",function(){$(this).siblings().removeClass("active"),$(this).addClass("active");var e=$(this).find(".value").html(),n=$(this).find(".value").attr("url");t.setValue({name:e,url:n}),t.handleClose()}),this.$showBox.on("click",this.toggle.bind(this)),this.on("valuechange",function(){this.$dataShow.html(this.getValue().name),this.$dataShow.attr("title",this.getValue().name)}),this.on("listchange",function(){this.optionsLimit&&this.options.length>=this.optionsLimit&&this.trigger("optionlimit"),this.$list.html(this.getOptionsStr()),this.setValue(this.getDefaultOption())}),this.on("optionempty",this.handleOptionEmpty.bind(this))},templete:function(){return'<div class="track-select-parent">\n              <div class="track-select-show">\n                <div class="data-show" title="'+this.getDefaultOption().name+'"></div>\n                <span class="track-selcet-open-arrow">\n                  <i class="es-icon es-icon-keyboardarrowdown"></i>\n                </span>\n                <span class="track-selcet-close-arrow" style="display:none;">\n                  <i class="es-icon es-icon-keyboardarrowup"></i>\n                </span>\n              </div>\n              <ul class="track-selcet-list" style="display:none;">\n                '+this.getOptionsStr()+"\n              </ul>\n            </div>"},getDefaultOption:function(){return this.options.length?this.options[0]:(this.open&&this.handleClose(),!1)},getOptionsStr:function(){this.options.length||this.trigger("optionempty");var t="";return this.options.map(function(e,n){t+='<li class="select-item">\n                        <div class="value" title="'+e.name+'" url="'+e.url+'">\n                          '+e.name+'\n                        </div>\n                        <span class="convertStatus convert-'+e.convertStatus+'">'+i(e.convertStatus)+'</span>\n                        <i class="es-icon es-icon-close01 delete" data-index="'+n+'"></i>\n                      </li>'}),t},setValue:function(t){if(!t)return this.$dataShow.html(Translator.trans("subtitle.no_subtitle_hint")),void this.trigger("valuechange",!1);this.value=t,this.trigger("valuechange",this.value)},getValue:function(){return this.value||{name:Translator.trans("subtitle.no_subtitle_hint")}},toggle:function(){this.open?this.handleClose():this.handleOpen()},handleOpen:function(){this.options.length&&(this.open=!0,this.$open.hide(),this.$close.show(),this.$showBox.addClass("active"),this.$list.slideDown(200))},handleClose:function(){this.open=!1,this.$close.hide(),this.$open.show(),this.$showBox.removeClass("active"),this.$list.slideUp(200)},handleDelete:function(t){var e=t.target;$(e).parent().remove(),this.trigger("deleteoption",this.options[$(e).data("index")]),this.options.splice($(e).data("index"),1),this.trigger("listchange",this.options),t.stopPropagation()},handleOptionEmpty:function(){this.value="",this.trigger("valuechange",!1)},on:function(t,e){this.eventManager[t]?this.eventManager[t].push(e.bind(this)):this.eventManager[t]=[e.bind(this)]},trigger:function(t,e){this.eventManager[t]&&this.eventManager[t].map(function(t){t(e)})},resetOptions:function(t){this.options=t,this.trigger("listchange",this.options)},addOption:function(t){t.convertStatus||(t.convertStatus="waiting"),this.options.push(t),this.trigger("listchange")}};e.default=s},a354ef45a5643f3faa0a:function(t,e,n){var i=n("7ea730999b7f9bc57768"),s=n("6d5fc844ee5e8f1afd1c");t.exports=function(t,e){if(!/(-|\+)?\d+/.test(e.toString()))throw new Error("Invalid time: "+e+".Expected a valid integer");return e=parseInt(e,10),t.map(function(t){var n=i(t.start),a=i(t.end);return n+=e,a+=e,t.start=s(n<0?0:n),t.end=s(a<0?0:a),t})}},b26ed6014df6ee9a0332:function(t,e,n){"use strict";var i=$("#lesson-dashboard"),s=i.data("media-player-url"),a="<iframe src='"+s+"' name='viewerIframe' id='viewerIframe' width='100%'allowfullscreen webkitallowfullscreen height='100%' style='border:0px'></iframe>";$("#lesson-video-content").html(a)},d5971171c2b26114cfc1:function(t,e,n){"use strict";function i(t){if(!(this instanceof i))return new i(t);this._subtitles=[],t&&this.parse(t)}var s=n("7ea730999b7f9bc57768"),a=n("6d5fc844ee5e8f1afd1c"),r=n("62dd28380e65e28b6966"),o=n("4fbc8f4e49952771dc85"),l=n("a354ef45a5643f3faa0a"),c=n("558e05aa09312b06bb5c"),d=n("27d19b4547a9c8dcdebe");t.exports=i;var u=i.prototype;u.parse=function(t){this._subtitles=r(t)},u.add=function(t){return d(this._subtitles,t),this},u.getSubtitles=function(t){return c(this._subtitles,t)},u.stringify=function(){return o(this._subtitles)},u.resync=function(t){return this._subtitles=l(this._subtitles,t),this},i.toMS=s,i.toSrtTime=a}},["0aaefd8f8edce9d8cb8f"]);